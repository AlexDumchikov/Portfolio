<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sales Report</title>
  <!-- Include Chart.js library -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- Include date-fns adapter for Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
  <!-- Include DataLabels plugin for Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
  <style>
    /* Main page styling */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f9f9f9;
      position: relative;
    }
    
    /* Source label styling */
    .source-label {
      position: absolute;
      top: 5px;
      left: 5px;
      font-size: 11px;
      color: gray;
      font-style: italic;
    }
    
    /* MS Teams icon styling */
    .teams-icon {
      position: absolute;
      top: 0px;
      right: 0px;
      width: 45px;
      height: 45px;
      cursor: pointer;
      box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.3); 
    }
    
    /* Page header styling */
    h1 {
      text-align: center;
      font-size: 20px;
      margin-top: 30px;
    }
    
    /* Summary cards container */
    .summary-container {
      display: flex; 
      flex-wrap: wrap; 
      gap: 15px; 
      justify-content: center; 
      margin-bottom: 20px;
    }
    
    /* Individual summary card styling */
    .summary-card {
      position: relative;
      display: flex;
      flex-direction: column;
      min-width: 140px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: left;
      border: 1px solid #f0f0f0;
      overflow: hidden;
    }
    
    /* Indicator icon styling */
    .summary-indicator {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      position: absolute;
      top: 15px;
      left: 15px;
      width: 24px;
      height: 24px;
      border-radius: 6px;
    }
    
    /* Positive indicator (green) */
    .indicator-positive {
      background-color: rgba(0, 128, 0, 0.1);
      color: green;
    }
    
    /* Negative indicator (red) */
    .indicator-negative {
      background-color: rgba(255, 0, 0, 0.1);
      color: red;
    }
    
    /* Neutral indicator (gray) */
    .indicator-neutral {
      background-color: rgba(128, 128, 128, 0.1);
      color: gray;
    }
    
    /* Summary title styling */
    .summary-title {
      font-weight: bold;
      margin-bottom: 8px;
      padding-left: 32px;
    }
    
    /* Summary value styling */
    .summary-value {
      font-size: 1.3em;
      font-weight: bold;
      margin-bottom: 4px;
    }
    
    /* Difference indicator styling */
    .summary-diff {
      font-size: 0.9em;
      display: flex;
      gap: 5px;
    }
    
    /* Positive difference styling */
    .diff-positive {
      color: green;
    }
    
    /* Negative difference styling */
    .diff-negative {
      color: red;
    }
    
    /* Amount and percentage styling */
    .diff-amount, .diff-percentage {
      font-weight: 500;
    }
    
    /* Filter container styling */
    .filter-container {
      display: flex; 
      flex-wrap: wrap; 
      align-items: center; 
      justify-content: center;
      gap: 15px; 
      margin-bottom: 20px; 
      padding: 10px; 
      background: #fff;
      border-radius: 8px; 
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    /* Individual filter element styling */
    .filter-container > div {
      border: 1px solid #ccc;
      padding: 5px;
      border-radius: 4px;
    }
    
    /* Filter label styling */
    .filter-container label { 
      font-weight: bold; 
      margin-right: 5px; 
    }
    
    /* Input and select styling */
    .filter-container input, .filter-container select {
      padding: 5px 8px; 
      border: 1px solid #ccc; 
      border-radius: 4px;
    }
    
    /* Grouping block highlight */
    .grouping-block {
      background-color: #e0f7ff;
    }
    
    /* Past period highlight */
    .past-period-block { 
      background-color: rgba(255,165,0,0.2); 
    }
    
    /* Anomalies highlight */
    .anomalies-block { 
      background-color: rgba(255,0,0,0.2); 
    }
    
    /* Average highlight */
    .average-block { 
      background-color: rgba(128,0,128,0.2); 
    }
    
    /* Chart container styling */
    .chart-container {
      border-radius: 8px; 
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
  <!-- Source information label -->
  <div class="source-label">Source: random data</div>
  
  <!-- MS Teams contact icon -->
  <a href="https://teams.microsoft.com/l/chat/0/0?users=vorota516@gmail.com" target="_blank">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/5/50/Microsoft_Teams.png/258px-Microsoft_Teams.png" alt="MS Teams" class="teams-icon">
  </a>
  
  <!-- Page header -->
  <h1>Test Sales Dynamics</h1>
  
  <!-- Summary cards container -->
  <div class="summary-container">
    <!-- Year-to-date summary card -->
    <div class="summary-card" id="summary-ytd">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">YTD</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
    
    <!-- Week-to-date summary card -->
    <div class="summary-card" id="summary-lastweek">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">Week-To-Date</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
    
    <!-- Month-to-date summary card -->
    <div class="summary-card" id="summary-lastmonth">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">Month-To-Date</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
    
    <!-- Last 3 months summary card -->
    <div class="summary-card" id="summary-last3m">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">Last 3M</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
    
    <!-- Last 6 months summary card -->
    <div class="summary-card" id="summary-last6m">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">Last 6M</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
    
    <!-- Last 12 months summary card -->
    <div class="summary-card" id="summary-last12m">
      <div class="summary-indicator">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
          <path d="M8 3L14 9H10V13H6V9H2L8 3Z" fill="currentColor" />
        </svg>
      </div>
      <div class="summary-title">Last 12M</div>
      <div class="summary-value">0</div>
      <div class="summary-diff">
        <span class="diff-amount">0</span>
        <span class="diff-percentage">(0%)</span>
      </div>
    </div>
  </div>

  <!-- Filters container -->
  <div class="filter-container">
    <!-- Start date filter -->
    <div>
      <label for="startDate">Start:</label>
      <input type="date" id="startDate">
    </div>
    
    <!-- End date filter -->
    <div>
      <label for="endDate">End:</label>
      <input type="date" id="endDate">
    </div>
    
    <!-- Grouping selector -->
    <div class="grouping-block">
      <label for="grouping">Grouping:</label>
      <select id="grouping">
        <option value="daily">Daily</option>
        <option value="weekly" selected>Weekly</option>
        <option value="monthly">Monthly</option>
        <option value="quarterly">Quarterly</option>
        <option value="yearly">Yearly</option>
      </select>
    </div>
    
    <!-- Past period toggle -->
    <div class="extra-checkbox past-period-block">
      <label for="togglePastPeriod">Past Period:</label>
      <input type="checkbox" id="togglePastPeriod" checked>
    </div>
    
    <!-- Grid toggle -->
    <div class="extra-checkbox">
      <label for="toggleGrid">Grid:</label>
      <input type="checkbox" id="toggleGrid" checked>
    </div>
    
    <!-- Data values toggle -->
    <div class="extra-checkbox">
      <label for="toggleDataValues">data:</label>
      <input type="checkbox" id="toggleDataValues">
    </div>
    
    <!-- Anomalies toggle -->
    <div class="extra-checkbox anomalies-block">
      <label for="toggleAnomalies">Anomalies:</label>
      <input type="checkbox" id="toggleAnomalies" checked>
    </div>
    
    <!-- Average toggle -->
    <div class="extra-checkbox average-block">
      <label for="toggleAverage">Average:</label>
      <input type="checkbox" id="toggleAverage">
    </div>
  </div>
  
  <!-- Chart container -->
  <div class="chart-container">
    <canvas id="salesChart" width="1200" height="400"></canvas>
  </div>
  
  <script>
    // Register Chart.js plugins
    Chart.register(ChartDataLabels);
    
    /**
     * Formats a date as YYYY-MM-DD
     * @param {Date|string} date - The date to format
     * @return {string} Formatted date string
     */
    function formatDate(date) {
      const d = new Date(date);
      let month = '' + (d.getMonth() + 1);
      let day = '' + d.getDate();
      const year = d.getFullYear();
      if (month.length < 2) month = '0' + month;
      if (day.length < 2) day = '0' + day;
      return [year, month, day].join('-');
    }
    
    /**
     * Subtracts one year from a date string
     * @param {string} dateStr - Date string in YYYY-MM-DD format
     * @return {string} Date string one year prior
     */
    function subtractOneYear(dateStr) {
      const date = new Date(dateStr);
      date.setFullYear(date.getFullYear() - 1);
      return formatDate(date);
    }

    /**
     * Gets the ISO week year for a date
     * @param {Date} date - The date to check
     * @return {number} The ISO week year
     */
    function getISOWeekYear(date) {
      const target = new Date(date.valueOf());
      const dayNr = (date.getDay() + 6) % 7;
      target.setDate(target.getDate() - dayNr + 3);
      return target.getFullYear();
    }
    
    /**
     * Groups sales data by the specified time period
     * @param {Array} data - Array of sales data objects
     * @param {string} grouping - Grouping type ('daily', 'weekly', 'monthly', 'quarterly', 'yearly')
     * @return {Array} Array of grouped data objects
     */
    function groupData(data, grouping) {
      const groups = {};
      data.forEach(item => {
        const date = new Date(item.date);
        let key = '';
        let sortDate = date;
        
        switch (grouping) {
          case 'daily':
            key = item.date;
            sortDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            break;
            
          case 'weekly': {
            const dateStr = formatDate(date);
            // Special handling for the week spanning year change (2024-12-30 to 2025-01-05)
            if (dateStr >= "2024-12-30" && dateStr <= "2025-01-05") {
              key = "2025-01";
              sortDate = new Date("2024-12-30");
            } else {
              const weekNumber = getWeekNumber(date);
              const weekStr = ("0" + weekNumber).slice(-2);
              const isoYear = getISOWeekYear(date);
              key = isoYear + '-' + weekStr;
              const dayNr = (date.getDay() + 6) % 7;
              const monday = new Date(date);
              monday.setDate(date.getDate() - dayNr);
              sortDate = monday;
            }
            break;
          }
            
          case 'monthly':
            key = date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2);
            sortDate = new Date(date.getFullYear(), date.getMonth(), 1);
            break;
            
          case 'quarterly': {
            const quarter = Math.floor(date.getMonth() / 3) + 1;
            key = date.getFullYear() + '-Q' + quarter;
            sortDate = new Date(date.getFullYear(), (quarter - 1) * 3, 1);
            break;
          }
            
          case 'yearly':
            key = date.getFullYear().toString();
            sortDate = new Date(date.getFullYear(), 0, 1);
            break;
            
          default:
            key = item.date;
            sortDate = date;
        }
        
        if (!groups[key]) {
          groups[key] = { total: 0, sortDate: sortDate, label: key };
        }
        groups[key].total += item.sales;
      });
      
      // Convert groups object to array and sort by date
      const result = [];
      for (let k in groups) {
        result.push({ label: groups[k].label, value: groups[k].total, sortDate: groups[k].sortDate });
      }
      result.sort((a, b) => a.sortDate - b.sortDate);
      return result;
    }
    
    /**
     * Gets the week number for a date
     * @param {Date} date - The date to check
     * @return {number} The week number
     */
    function getWeekNumber(date) {
      const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
      const dayNum = d.getUTCDay() || 7;
      d.setUTCDate(d.getUTCDate() + 4 - dayNum);
      const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
      return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }
    
    /**
     * Gets the label for the past period (1 year ago)
     * @param {string} label - Current period label
     * @param {string} grouping - Grouping type
     * @return {string} Past period label
     */
    function getPastLabel(label, grouping) {
      if (grouping === 'daily') {
        const parts = label.split('-');
        const year = parseInt(parts[0]) - 1;
        return year + '-' + parts[1] + '-' + parts[2];
      } else if (grouping === 'weekly') {
        const parts = label.split('-');
        const year = parseInt(parts[0]) - 1;
        return year + '-' + parts[1];
      } else if (grouping === 'monthly') {
        const parts = label.split('-');
        const year = parseInt(parts[0]) - 1;
        return year + '-' + parts[1];
      } else if (grouping === 'quarterly') {
        const parts = label.split('-Q');
        const year = parseInt(parts[0]) - 1;
        return year + '-Q' + parts[1];
      } else if (grouping === 'yearly') {
        const year = parseInt(label) - 1;
        return year.toString();
      }
      return label;
    }
    
    /**
     * Formats the X-axis label based on grouping type
     * @param {Date} date - The date to format
     * @param {string} grouping - Grouping type
     * @return {string} Formatted label
     */
    function formatXAxisLabel(date, grouping) {
      if (grouping === 'weekly') {
        const dateStr = formatDate(date);
        // Special handling for the week spanning year change
        if (dateStr >= "2024-12-30" && dateStr <= "2025-01-05") {
          return "2025-01";
        }
        const weekNumber = getWeekNumber(date);
        const weekStr = ("0" + weekNumber).slice(-2);
        return date.getFullYear() + '-' + weekStr;
      } else if (grouping === 'monthly') {
        return date.toLocaleString('en-US', { month: 'short', year: '2-digit' }).replace(' ', '-');
      } else if (grouping === 'quarterly') {
        const quarter = Math.floor(date.getMonth() / 3) + 1;
        return date.getFullYear() + '-Q' + quarter;
      } else if (grouping === 'yearly') {
        return date.getFullYear().toString();
      }
      return date.toLocaleDateString();
    }
    
    /**
     * Sums sales within a date range
     * @param {Array} data - Sales data array
     * @param {string} start - Start date string
     * @param {string} end - End date string
     * @return {number} Total sales in the range
     */
    function sumSalesInRange(data, start, end) {
      const startTime = new Date(start).getTime();
      const endTime = new Date(end).getTime();
      let sum = 0;
      data.forEach(item => {
        const t = new Date(item.date).getTime();
        if (t >= startTime && t <= endTime) {
          sum += item.sales;
        }
      });
      return sum;
    }
    
    /**
     * Gets the date N days before a given date
     * @param {string} dateStr - Starting date string
     * @param {number} n - Number of days to go back
     * @return {string} Date string N days before
     */
    function dateNDaysBefore(dateStr, n) {
      const d = new Date(dateStr);
      d.setDate(d.getDate() - n);
      return formatDate(d);
    }
    
    /**
     * Formats a number with 1 decimal place
     * @param {number} num - The number to format
     * @return {string} Formatted number string
     */
    function formatNumber(num) {
      return num.toLocaleString('en-US', { minimumFractionDigits: 1, maximumFractionDigits: 1 });
    }
    
    /**
     * Updates a summary card with current and previous values
     * @param {string} cardId - ID of the card element
     * @param {number} currentSum - Current period sum
     * @param {number} previousSum - Previous period sum
     */
    function updateSummaryCard(cardId, currentSum, previousSum) {
      const card = document.getElementById(cardId);
      if (!card) return;
      
      const valueEl = card.querySelector(".summary-value");
      const diffAmountEl = card.querySelector(".diff-amount");
      const diffPercentEl = card.querySelector(".diff-percentage");
      const indicator = card.querySelector(".summary-indicator");
      
      // Update the main value
      valueEl.textContent = formatNumber(currentSum);
      
      // Calculate difference and percentage
      const diff = currentSum - previousSum;
      const diffPercent = previousSum !== 0 ? (diff / previousSum) * 100 : 0;
      const diffStr = formatNumber(diff);
      const pctStr = "(" + (diff >= 0 ? "+" : "") + formatNumber(diffPercent) + "%)";
      
      // If this is the YTD card, update the page title
      if(cardId === "summary-ytd"){
        document.title = "Sales YTD: " + formatNumber(currentSum) + " " + pctStr;
      }
      
      // Update the indicator icon and colors based on difference
      const svgPath = indicator.querySelector("path");
      if (diff > 0) {
        // Positive change - green up arrow
        indicator.classList.remove("indicator-negative", "indicator-neutral");
        indicator.classList.add("indicator-positive");
        card.querySelector(".summary-diff").classList.remove("diff-negative");
        card.querySelector(".summary-diff").classList.add("diff-positive");
        svgPath.setAttribute("d", "M8 3L14 9H10V13H6V9H2L8 3Z"); 
      } else if (diff < 0) {
        // Negative change - red down arrow
        indicator.classList.remove("indicator-positive", "indicator-neutral");
        indicator.classList.add("indicator-negative");
        card.querySelector(".summary-diff").classList.remove("diff-positive");
        card.querySelector(".summary-diff").classList.add("diff-negative");
        svgPath.setAttribute("d", "M8 13L2 7H6V3H10V7H14L8 13Z");
      } else {
        // No change - gray horizontal line
        indicator.classList.remove("indicator-positive", "indicator-negative");
        indicator.classList.add("indicator-neutral");
        card.querySelector(".summary-diff").classList.remove("diff-positive", "diff-negative");
        svgPath.setAttribute("d", "M3 8H13");
      }
      
      // Update difference values
      diffAmountEl.textContent = diffStr;
      diffPercentEl.textContent = pctStr;
    }
    
    /**
     * Updates a summary period card (like last 3M, 6M, 12M)
     * @param {string} cardId - ID of the card element
     * @param {number} days - Number of days in the period
     * @param {Array} data - Sales data array
     * @param {string} endStr - End date string
     */
    function updateSummaryPeriod(cardId, days, data, endStr) {
      const startStr = dateNDaysBefore(endStr, days - 1);
      const sumCurrent = sumSalesInRange(data, startStr, endStr);
      const prevEndStr = dateNDaysBefore(startStr, 1);
      const prevStartStr = dateNDaysBefore(prevEndStr, days - 1);
      const sumPrev = sumSalesInRange(data, prevStartStr, prevEndStr);
      updateSummaryCard(cardId, sumCurrent, sumPrev);
    }
    
    /**
     * Renders all summary cards
     * @param {Array} allData - Complete sales data array
     */
    function renderSummaries(allData) {
      if (!allData.length) {
        resetAllSummaries();
        return;
      }
      
      // Find the most recent date in the data
      const maxDate = new Date(Math.max(...allData.map(item => new Date(item.date).getTime())));
      const endStr = formatDate(maxDate);
      
      // YTD calculation
      const currentYear = maxDate.getFullYear();
      const ytdStartStr = formatDate(new Date(currentYear, 0, 1));
      const ytdPrevStart = formatDate(new Date(currentYear - 1, 0, 1));
      const ytdPrevEnd = formatDate(new Date(currentYear - 1, maxDate.getMonth(), maxDate.getDate()));
      const ytdSum = sumSalesInRange(allData, ytdStartStr, endStr);
      const ytdPrevSum = sumSalesInRange(allData, ytdPrevStart, ytdPrevEnd);
      updateSummaryCard("summary-ytd", ytdSum, ytdPrevSum);
      
      // Week-to-date calculation
      const monday = getMonday(maxDate);
      const weekToDateSum = sumSalesInRange(allData, formatDate(monday), endStr);
      const weekDaysCount = Math.floor((maxDate.getTime() - monday.getTime()) / 86400000) + 1;
      const previousMonday = new Date(monday);
      previousMonday.setDate(previousMonday.getDate() - 7);
      const previousWeekEnd = new Date(previousMonday);
      previousWeekEnd.setDate(previousWeekEnd.getDate() + weekDaysCount - 1);
      const weekToDatePrevSum = sumSalesInRange(allData, formatDate(previousMonday), formatDate(previousWeekEnd));
      updateSummaryCard("summary-lastweek", weekToDateSum, weekToDatePrevSum);
      
      // Month-to-date calculation
      const currentMonthStart = new Date(maxDate.getFullYear(), maxDate.getMonth(), 1);
      const monthToDateSum = sumSalesInRange(allData, formatDate(currentMonthStart), endStr);
      const previousMonthStart = new Date(maxDate.getFullYear(), maxDate.getMonth() - 1, 1);
      const previousMonthEnd = new Date(previousMonthStart);
      previousMonthEnd.setDate(previousMonthEnd.getDate() + maxDate.getDate() - 1);
      const monthToDatePrevSum = sumSalesInRange(allData, formatDate(previousMonthStart), formatDate(previousMonthEnd));
      updateSummaryCard("summary-lastmonth", monthToDateSum, monthToDatePrevSum);
      
      // Last 3M, 6M, 12M calculations
      updateSummaryPeriod("summary-last3m", 90, allData, endStr);
      updateSummaryPeriod("summary-last6m", 180, allData, endStr);
      updateSummaryPeriod("summary-last12m", 365, allData, endStr);
    }
    
    /**
     * Resets all summary cards to zero values
     */
    function resetAllSummaries() {
      const ids = ["summary-ytd", "summary-lastweek", "summary-lastmonth", "summary-last3m", "summary-last6m", "summary-last12m"];
      ids.forEach(id => {
        const card = document.getElementById(id);
        if (!card) return;
        card.querySelector(".summary-value").textContent = "0";
        card.querySelector(".diff-amount").textContent = "0";
        card.querySelector(".diff-percentage").textContent = "(0%)";
        const indicator = card.querySelector(".summary-indicator");
        indicator.classList.remove("indicator-positive", "indicator-negative");
        indicator.classList.add("indicator-neutral");
        const svgPath = indicator.querySelector("path");
        svgPath.setAttribute("d", "M3 8H13");
        card.querySelector(".summary-diff").classList.remove("diff-positive", "diff-negative");
      });
    }
    
    /**
     * Gets the Monday of the week for a given date
     * @param {Date} date - The date to check
     * @return {Date} The Monday of that week
     */
    function getMonday(date) {
      const d = new Date(date);
      const day = d.getDay();
      const diff = d.getDate() - (day === 0 ? 6 : day - 1);
      return new Date(d.getFullYear(), d.getMonth(), diff);
    }
    
    /**
     * Initializes date filters with min/max dates from the data
     */
    function initializeDateFilters() {
      const startDateInput = document.getElementById('startDate');
      const endDateInput = document.getElementById('endDate');
      const dates = salesData.map(item => new Date(item.date));
      const minDate = new Date(Math.min(...dates));
      const maxDate = new Date(Math.max(...dates));
      
      // Set filter ranges and default values
      startDateInput.min = formatDate(minDate);
      startDateInput.max = formatDate(maxDate);
      endDateInput.min = formatDate(minDate);
      endDateInput.max = formatDate(maxDate);
      startDateInput.value = formatDate(minDate);
      endDateInput.value = formatDate(maxDate);
    }
    
    // Sample sales data (would normally come from an API)
    const salesData = [

{ date: '2023-01-02', sales: 188},
{ date: '2023-01-03', sales: 109},
{ date: '2023-01-04', sales: 197},
{ date: '2023-01-05', sales: 176},
{ date: '2023-01-06', sales: 134},
{ date: '2023-01-07', sales: 158},
{ date: '2023-01-08', sales: 171},
{ date: '2023-01-09', sales: 183},
{ date: '2023-01-10', sales: 155},
{ date: '2023-01-11', sales: 109},
{ date: '2023-01-12', sales: 186},
{ date: '2023-01-13', sales: 164},
{ date: '2023-01-14', sales: 143},
{ date: '2023-01-15', sales: 155},
{ date: '2023-01-16', sales: 191},
{ date: '2023-01-17', sales: 191},
{ date: '2023-01-18', sales: 109},
{ date: '2023-01-19', sales: 153},
{ date: '2023-01-20', sales: 105},
{ date: '2023-01-21', sales: 120},
{ date: '2023-01-22', sales: 175},
{ date: '2023-01-23', sales: 114},
{ date: '2023-01-24', sales: 150},
{ date: '2023-01-25', sales: 168},
{ date: '2023-01-26', sales: 198},
{ date: '2023-01-27', sales: 174},
{ date: '2023-01-28', sales: 116},
{ date: '2023-01-29', sales: 193},
{ date: '2023-01-30', sales: 105},
{ date: '2023-01-31', sales: 191},
{ date: '2023-02-01', sales: 143},
{ date: '2023-02-02', sales: 178},
{ date: '2023-02-03', sales: 166},
{ date: '2023-02-04', sales: 114},
{ date: '2023-02-05', sales: 152},
{ date: '2023-02-06', sales: 144},
{ date: '2023-02-07', sales: 179},
{ date: '2023-02-08', sales: 169},
{ date: '2023-02-09', sales: 146},
{ date: '2023-02-10', sales: 107},
{ date: '2023-02-11', sales: 138},
{ date: '2023-02-12', sales: 148},
{ date: '2023-02-13', sales: 154},
{ date: '2023-02-14', sales: 120},
{ date: '2023-02-15', sales: 128},
{ date: '2023-02-16', sales: 121},
{ date: '2023-02-17', sales: 117},
{ date: '2023-02-18', sales: 149},
{ date: '2023-02-19', sales: 141},
{ date: '2023-02-20', sales: 179},
{ date: '2023-02-21', sales: 119},
{ date: '2023-02-22', sales: 161},
{ date: '2023-02-23', sales: 101},
{ date: '2023-02-24', sales: 198},
{ date: '2023-02-25', sales: 119},
{ date: '2023-02-26', sales: 134},
{ date: '2023-02-27', sales: 181},
{ date: '2023-02-28', sales: 108},
{ date: '2023-03-01', sales: 198},
{ date: '2023-03-02', sales: 112},
{ date: '2023-03-03', sales: 153},
{ date: '2023-03-04', sales: 171},
{ date: '2023-03-05', sales: 134},
{ date: '2023-03-06', sales: 198},
{ date: '2023-03-07', sales: 164},
{ date: '2023-03-08', sales: 157},
{ date: '2023-03-09', sales: 191},
{ date: '2023-03-10', sales: 119},
{ date: '2023-03-11', sales: 142},
{ date: '2023-03-12', sales: 147},
{ date: '2023-03-13', sales: 184},
{ date: '2023-03-14', sales: 151},
{ date: '2023-03-15', sales: 109},
{ date: '2023-03-16', sales: 199},
{ date: '2023-03-17', sales: 112},
{ date: '2023-03-18', sales: 198},
{ date: '2023-03-19', sales: 159},
{ date: '2023-03-20', sales: 188},
{ date: '2023-03-21', sales: 121},
{ date: '2023-03-22', sales: 147},
{ date: '2023-03-23', sales: 102},
{ date: '2023-03-24', sales: 140},
{ date: '2023-03-25', sales: 123},
{ date: '2023-03-26', sales: 173},
{ date: '2023-03-27', sales: 123},
{ date: '2023-03-28', sales: 197},
{ date: '2023-03-29', sales: 147},
{ date: '2023-03-30', sales: 110},
{ date: '2023-03-31', sales: 103},
{ date: '2023-04-01', sales: 142},
{ date: '2023-04-02', sales: 175},
{ date: '2023-04-03', sales: 145},
{ date: '2023-04-04', sales: 151},
{ date: '2023-04-05', sales: 160},
{ date: '2023-04-06', sales: 176},
{ date: '2023-04-07', sales: 112},
{ date: '2023-04-08', sales: 135},
{ date: '2023-04-09', sales: 152},
{ date: '2023-04-10', sales: 108},
{ date: '2023-04-11', sales: 179},
{ date: '2023-04-12', sales: 186},
{ date: '2023-04-13', sales: 129},
{ date: '2023-04-14', sales: 142},
{ date: '2023-04-15', sales: 196},
{ date: '2023-04-16', sales: 171},
{ date: '2023-04-17', sales: 127},
{ date: '2023-04-18', sales: 124},
{ date: '2023-04-19', sales: 117},
{ date: '2023-04-20', sales: 184},
{ date: '2023-04-21', sales: 183},
{ date: '2023-04-22', sales: 113},
{ date: '2023-04-23', sales: 129},
{ date: '2023-04-24', sales: 177},
{ date: '2023-04-25', sales: 154},
{ date: '2023-04-26', sales: 130},
{ date: '2023-04-27', sales: 145},
{ date: '2023-04-28', sales: 124},
{ date: '2023-04-29', sales: 177},
{ date: '2023-04-30', sales: 167},
{ date: '2023-05-01', sales: 181},
{ date: '2023-05-02', sales: 127},
{ date: '2023-05-03', sales: 131},
{ date: '2023-05-04', sales: 147},
{ date: '2023-05-05', sales: 108},
{ date: '2023-05-06', sales: 100},
{ date: '2023-05-07', sales: 143},
{ date: '2023-05-08', sales: 148},
{ date: '2023-05-09', sales: 176},
{ date: '2023-05-10', sales: 134},
{ date: '2023-05-11', sales: 124},
{ date: '2023-05-12', sales: 125},
{ date: '2023-05-13', sales: 184},
{ date: '2023-05-14', sales: 131},
{ date: '2023-05-15', sales: 194},
{ date: '2023-05-16', sales: 186},
{ date: '2023-05-17', sales: 182},
{ date: '2023-05-18', sales: 177},
{ date: '2023-05-19', sales: 185},
{ date: '2023-05-20', sales: 130},
{ date: '2023-05-21', sales: 108},
{ date: '2023-05-22', sales: 194},
{ date: '2023-05-23', sales: 157},
{ date: '2023-05-24', sales: 145},
{ date: '2023-05-25', sales: 112},
{ date: '2023-05-26', sales: 118},
{ date: '2023-05-27', sales: 198},
{ date: '2023-05-28', sales: 166},
{ date: '2023-05-29', sales: 144},
{ date: '2023-05-30', sales: 146},
{ date: '2023-05-31', sales: 129},
{ date: '2023-06-01', sales: 109},
{ date: '2023-06-02', sales: 176},
{ date: '2023-06-03', sales: 155},
{ date: '2023-06-04', sales: 166},
{ date: '2023-06-05', sales: 176},
{ date: '2023-06-06', sales: 199},
{ date: '2023-06-07', sales: 193},
{ date: '2023-06-08', sales: 161},
{ date: '2023-06-09', sales: 150},
{ date: '2023-06-10', sales: 176},
{ date: '2023-06-11', sales: 135},
{ date: '2023-06-12', sales: 162},
{ date: '2023-06-13', sales: 100},
{ date: '2023-06-14', sales: 158},
{ date: '2023-06-15', sales: 154},
{ date: '2023-06-16', sales: 188},
{ date: '2023-06-17', sales: 162},
{ date: '2023-06-18', sales: 126},
{ date: '2023-06-19', sales: 151},
{ date: '2023-06-20', sales: 113},
{ date: '2023-06-21', sales: 138},
{ date: '2023-06-22', sales: 144},
{ date: '2023-06-23', sales: 133},
{ date: '2023-06-24', sales: 134},
{ date: '2023-06-25', sales: 106},
{ date: '2023-06-26', sales: 167},
{ date: '2023-06-27', sales: 169},
{ date: '2023-06-28', sales: 152},
{ date: '2023-06-29', sales: 144},
{ date: '2023-06-30', sales: 138},
{ date: '2023-07-01', sales: 149},
{ date: '2023-07-02', sales: 169},
{ date: '2023-07-03', sales: 138},
{ date: '2023-07-04', sales: 196},
{ date: '2023-07-05', sales: 147},
{ date: '2023-07-06', sales: 197},
{ date: '2023-07-07', sales: 181},
{ date: '2023-07-08', sales: 183},
{ date: '2023-07-09', sales: 141},
{ date: '2023-07-10', sales: 156},
{ date: '2023-07-11', sales: 168},
{ date: '2023-07-12', sales: 123},
{ date: '2023-07-13', sales: 102},
{ date: '2023-07-14', sales: 152},
{ date: '2023-07-15', sales: 156},
{ date: '2023-07-16', sales: 177},
{ date: '2023-07-17', sales: 100},
{ date: '2023-07-18', sales: 118},
{ date: '2023-07-19', sales: 185},
{ date: '2023-07-20', sales: 159},
{ date: '2023-07-21', sales: 149},
{ date: '2023-07-22', sales: 187},
{ date: '2023-07-23', sales: 175},
{ date: '2023-07-24', sales: 120},
{ date: '2023-07-25', sales: 115},
{ date: '2023-07-26', sales: 178},
{ date: '2023-07-27', sales: 143},
{ date: '2023-07-28', sales: 109},
{ date: '2023-07-29', sales: 116},
{ date: '2023-07-30', sales: 116},
{ date: '2023-07-31', sales: 103},
{ date: '2023-08-01', sales: 174},
{ date: '2023-08-02', sales: 180},
{ date: '2023-08-03', sales: 111},
{ date: '2023-08-04', sales: 154},
{ date: '2023-08-05', sales: 162},
{ date: '2023-08-06', sales: 123},
{ date: '2023-08-07', sales: 100},
{ date: '2023-08-08', sales: 144},
{ date: '2023-08-09', sales: 104},
{ date: '2023-08-10', sales: 149},
{ date: '2023-08-11', sales: 123},
{ date: '2023-08-12', sales: 129},
{ date: '2023-08-13', sales: 160},
{ date: '2023-08-14', sales: 131},
{ date: '2023-08-15', sales: 160},
{ date: '2023-08-16', sales: 152},
{ date: '2023-08-17', sales: 132},
{ date: '2023-08-18', sales: 186},
{ date: '2023-08-19', sales: 147},
{ date: '2023-08-20', sales: 158},
{ date: '2023-08-21', sales: 107},
{ date: '2023-08-22', sales: 133},
{ date: '2023-08-23', sales: 200},
{ date: '2023-08-24', sales: 113},
{ date: '2023-08-25', sales: 114},
{ date: '2023-08-26', sales: 176},
{ date: '2023-08-27', sales: 118},
{ date: '2023-08-28', sales: 192},
{ date: '2023-08-29', sales: 151},
{ date: '2023-08-30', sales: 150},
{ date: '2023-08-31', sales: 199},
{ date: '2023-09-01', sales: 116},
{ date: '2023-09-02', sales: 159},
{ date: '2023-09-03', sales: 185},
{ date: '2023-09-04', sales: 172},
{ date: '2023-09-05', sales: 140},
{ date: '2023-09-06', sales: 133},
{ date: '2023-09-07', sales: 193},
{ date: '2023-09-08', sales: 114},
{ date: '2023-09-09', sales: 177},
{ date: '2023-09-10', sales: 128},
{ date: '2023-09-11', sales: 122},
{ date: '2023-09-12', sales: 185},
{ date: '2023-09-13', sales: 116},
{ date: '2023-09-14', sales: 195},
{ date: '2023-09-15', sales: 192},
{ date: '2023-09-16', sales: 175},
{ date: '2023-09-17', sales: 161},
{ date: '2023-09-18', sales: 145},
{ date: '2023-09-19', sales: 103},
{ date: '2023-09-20', sales: 114},
{ date: '2023-09-21', sales: 152},
{ date: '2023-09-22', sales: 197},
{ date: '2023-09-23', sales: 113},
{ date: '2023-09-24', sales: 144},
{ date: '2023-09-25', sales: 162},
{ date: '2023-09-26', sales: 118},
{ date: '2023-09-27', sales: 110},
{ date: '2023-09-28', sales: 133},
{ date: '2023-09-29', sales: 141},
{ date: '2023-09-30', sales: 154},
{ date: '2023-10-01', sales: 195},
{ date: '2023-10-02', sales: 137},
{ date: '2023-10-03', sales: 190},
{ date: '2023-10-04', sales: 164},
{ date: '2023-10-05', sales: 192},
{ date: '2023-10-06', sales: 166},
{ date: '2023-10-07', sales: 118},
{ date: '2023-10-08', sales: 175},
{ date: '2023-10-09', sales: 184},
{ date: '2023-10-10', sales: 122},
{ date: '2023-10-11', sales: 173},
{ date: '2023-10-12', sales: 149},
{ date: '2023-10-13', sales: 159},
{ date: '2023-10-14', sales: 195},
{ date: '2023-10-15', sales: 200},
{ date: '2023-10-16', sales: 196},
{ date: '2023-10-17', sales: 123},
{ date: '2023-10-18', sales: 138},
{ date: '2023-10-19', sales: 111},
{ date: '2023-10-20', sales: 186},
{ date: '2023-10-21', sales: 136},
{ date: '2023-10-22', sales: 196},
{ date: '2023-10-23', sales: 109},
{ date: '2023-10-24', sales: 108},
{ date: '2023-10-25', sales: 197},
{ date: '2023-10-26', sales: 175},
{ date: '2023-10-27', sales: 126},
{ date: '2023-10-28', sales: 168},
{ date: '2023-10-29', sales: 141},
{ date: '2023-10-30', sales: 141},
{ date: '2023-10-31', sales: 103},
{ date: '2023-11-01', sales: 122},
{ date: '2023-11-02', sales: 169},
{ date: '2023-11-03', sales: 140},
{ date: '2023-11-04', sales: 142},
{ date: '2023-11-05', sales: 194},
{ date: '2023-11-06', sales: 143},
{ date: '2023-11-07', sales: 124},
{ date: '2023-11-08', sales: 130},
{ date: '2023-11-09', sales: 170},
{ date: '2023-11-10', sales: 179},
{ date: '2023-11-11', sales: 139},
{ date: '2023-11-12', sales: 187},
{ date: '2023-11-13', sales: 198},
{ date: '2023-11-14', sales: 107},
{ date: '2023-11-15', sales: 172},
{ date: '2023-11-16', sales: 121},
{ date: '2023-11-17', sales: 187},
{ date: '2023-11-18', sales: 173},
{ date: '2023-11-19', sales: 177},
{ date: '2023-11-20', sales: 138},
{ date: '2023-11-21', sales: 141},
{ date: '2023-11-22', sales: 172},
{ date: '2023-11-23', sales: 115},
{ date: '2023-11-24', sales: 151},
{ date: '2023-11-25', sales: 140},
{ date: '2023-11-26', sales: 184},
{ date: '2023-11-27', sales: 145},
{ date: '2023-11-28', sales: 198},
{ date: '2023-11-29', sales: 169},
{ date: '2023-11-30', sales: 138},
{ date: '2023-12-01', sales: 194},
{ date: '2023-12-02', sales: 170},
{ date: '2023-12-03', sales: 144},
{ date: '2023-12-04', sales: 177},
{ date: '2023-12-05', sales: 181},
{ date: '2023-12-06', sales: 117},
{ date: '2023-12-07', sales: 115},
{ date: '2023-12-08', sales: 157},
{ date: '2023-12-09', sales: 188},
{ date: '2023-12-10', sales: 183},
{ date: '2023-12-11', sales: 116},
{ date: '2023-12-12', sales: 114},
{ date: '2023-12-13', sales: 167},
{ date: '2023-12-14', sales: 175},
{ date: '2023-12-15', sales: 168},
{ date: '2023-12-16', sales: 168},
{ date: '2023-12-17', sales: 177},
{ date: '2023-12-18', sales: 101},
{ date: '2023-12-19', sales: 162},
{ date: '2023-12-20', sales: 123},
{ date: '2023-12-21', sales: 129},
{ date: '2023-12-22', sales: 100},
{ date: '2023-12-23', sales: 164},
{ date: '2023-12-24', sales: 132},
{ date: '2023-12-25', sales: 159},
{ date: '2023-12-26', sales: 189},
{ date: '2023-12-27', sales: 136},
{ date: '2023-12-28', sales: 196},
{ date: '2023-12-29', sales: 131},
{ date: '2023-12-30', sales: 112},
{ date: '2023-12-31', sales: 141},
{ date: '2024-01-01', sales: 108},
{ date: '2024-01-02', sales: 199},
{ date: '2024-01-03', sales: 140},
{ date: '2024-01-04', sales: 153},
{ date: '2024-01-05', sales: 153},
{ date: '2024-01-06', sales: 163},
{ date: '2024-01-07', sales: 133},
{ date: '2024-01-08', sales: 134},
{ date: '2024-01-09', sales: 176},
{ date: '2024-01-10', sales: 192},
{ date: '2024-01-11', sales: 198},
{ date: '2024-01-12', sales: 194},
{ date: '2024-01-13', sales: 186},
{ date: '2024-01-14', sales: 183},
{ date: '2024-01-15', sales: 106},
{ date: '2024-01-16', sales: 164},
{ date: '2024-01-17', sales: 196},
{ date: '2024-01-18', sales: 119},
{ date: '2024-01-19', sales: 125},
{ date: '2024-01-20', sales: 142},
{ date: '2024-01-21', sales: 165},
{ date: '2024-01-22', sales: 191},
{ date: '2024-01-23', sales: 166},
{ date: '2024-01-24', sales: 131},
{ date: '2024-01-25', sales: 102},
{ date: '2024-01-26', sales: 137},
{ date: '2024-01-27', sales: 163},
{ date: '2024-01-28', sales: 150},
{ date: '2024-01-29', sales: 101},
{ date: '2024-01-30', sales: 110},
{ date: '2024-01-31', sales: 164},
{ date: '2024-02-01', sales: 200},
{ date: '2024-02-02', sales: 114},
{ date: '2024-02-03', sales: 118},
{ date: '2024-02-04', sales: 182},
{ date: '2024-02-05', sales: 144},
{ date: '2024-02-06', sales: 181},
{ date: '2024-02-07', sales: 126},
{ date: '2024-02-08', sales: 122},
{ date: '2024-02-09', sales: 189},
{ date: '2024-02-10', sales: 103},
{ date: '2024-02-11', sales: 159},
{ date: '2024-02-12', sales: 129},
{ date: '2024-02-13', sales: 173},
{ date: '2024-02-14', sales: 151},
{ date: '2024-02-15', sales: 129},
{ date: '2024-02-16', sales: 124},
{ date: '2024-02-17', sales: 182},
{ date: '2024-02-18', sales: 113},
{ date: '2024-02-19', sales: 123},
{ date: '2024-02-20', sales: 112},
{ date: '2024-02-21', sales: 146},
{ date: '2024-02-22', sales: 144},
{ date: '2024-02-23', sales: 139},
{ date: '2024-02-24', sales: 124},
{ date: '2024-02-25', sales: 126},
{ date: '2024-02-26', sales: 185},
{ date: '2024-02-27', sales: 162},
{ date: '2024-02-28', sales: 132},
{ date: '2024-02-29', sales: 192},
{ date: '2024-03-01', sales: 157},
{ date: '2024-03-02', sales: 114},
{ date: '2024-03-03', sales: 190},
{ date: '2024-03-04', sales: 117},
{ date: '2024-03-05', sales: 129},
{ date: '2024-03-06', sales: 194},
{ date: '2024-03-07', sales: 158},
{ date: '2024-03-08', sales: 172},
{ date: '2024-03-09', sales: 200},
{ date: '2024-03-10', sales: 115},
{ date: '2024-03-11', sales: 196},
{ date: '2024-03-12', sales: 168},
{ date: '2024-03-13', sales: 173},
{ date: '2024-03-14', sales: 112},
{ date: '2024-03-15', sales: 158},
{ date: '2024-03-16', sales: 132},
{ date: '2024-03-17', sales: 147},
{ date: '2024-03-18', sales: 103},
{ date: '2024-03-19', sales: 112},
{ date: '2024-03-20', sales: 100},
{ date: '2024-03-21', sales: 196},
{ date: '2024-03-22', sales: 154},
{ date: '2024-03-23', sales: 190},
{ date: '2024-03-24', sales: 188},
{ date: '2024-03-25', sales: 176},
{ date: '2024-03-26', sales: 136},
{ date: '2024-03-27', sales: 151},
{ date: '2024-03-28', sales: 117},
{ date: '2024-03-29', sales: 115},
{ date: '2024-03-30', sales: 160},
{ date: '2024-03-31', sales: 145},
{ date: '2024-04-01', sales: 115},
{ date: '2024-04-02', sales: 188},
{ date: '2024-04-03', sales: 146},
{ date: '2024-04-04', sales: 114},
{ date: '2024-04-05', sales: 140},
{ date: '2024-04-06', sales: 100},
{ date: '2024-04-07', sales: 137},
{ date: '2024-04-08', sales: 183},
{ date: '2024-04-09', sales: 184},
{ date: '2024-04-10', sales: 117},
{ date: '2024-04-11', sales: 179},
{ date: '2024-04-12', sales: 131},
{ date: '2024-04-13', sales: 107},
{ date: '2024-04-14', sales: 167},
{ date: '2024-04-15', sales: 200},
{ date: '2024-04-16', sales: 146},
{ date: '2024-04-17', sales: 126},
{ date: '2024-04-18', sales: 128},
{ date: '2024-04-19', sales: 174},
{ date: '2024-04-20', sales: 133},
{ date: '2024-04-21', sales: 180},
{ date: '2024-04-22', sales: 157},
{ date: '2024-04-23', sales: 135},
{ date: '2024-04-24', sales: 122},
{ date: '2024-04-25', sales: 173},
{ date: '2024-04-26', sales: 146},
{ date: '2024-04-27', sales: 115},
{ date: '2024-04-28', sales: 131},
{ date: '2024-04-29', sales: 154},
{ date: '2024-04-30', sales: 122},
{ date: '2024-05-01', sales: 195},
{ date: '2024-05-02', sales: 191},
{ date: '2024-05-03', sales: 114},
{ date: '2024-05-04', sales: 141},
{ date: '2024-05-05', sales: 147},
{ date: '2024-05-06', sales: 189},
{ date: '2024-05-07', sales: 187},
{ date: '2024-05-08', sales: 195},
{ date: '2024-05-09', sales: 147},
{ date: '2024-05-10', sales: 182},
{ date: '2024-05-11', sales: 190},
{ date: '2024-05-12', sales: 175},
{ date: '2024-05-13', sales: 158},
{ date: '2024-05-14', sales: 165},
{ date: '2024-05-15', sales: 174},
{ date: '2024-05-16', sales: 142},
{ date: '2024-05-17', sales: 141},
{ date: '2024-05-18', sales: 184},
{ date: '2024-05-19', sales: 124},
{ date: '2024-05-20', sales: 136},
{ date: '2024-05-21', sales: 176},
{ date: '2024-05-22', sales: 153},
{ date: '2024-05-23', sales: 152},
{ date: '2024-05-24', sales: 111},
{ date: '2024-05-25', sales: 171},
{ date: '2024-05-26', sales: 104},
{ date: '2024-05-27', sales: 143},
{ date: '2024-05-28', sales: 148},
{ date: '2024-05-29', sales: 145},
{ date: '2024-05-30', sales: 177},
{ date: '2024-05-31', sales: 141},
{ date: '2024-06-01', sales: 134},
{ date: '2024-06-02', sales: 186},
{ date: '2024-06-03', sales: 157},
{ date: '2024-06-04', sales: 158},
{ date: '2024-06-05', sales: 114},
{ date: '2024-06-06', sales: 180},
{ date: '2024-06-07', sales: 134},
{ date: '2024-06-08', sales: 114},
{ date: '2024-06-09', sales: 179},
{ date: '2024-06-10', sales: 139},
{ date: '2024-06-11', sales: 119},
{ date: '2024-06-12', sales: 163},
{ date: '2024-06-13', sales: 188},
{ date: '2024-06-14', sales: 170},
{ date: '2024-06-15', sales: 101},
{ date: '2024-06-16', sales: 184},
{ date: '2024-06-17', sales: 130},
{ date: '2024-06-18', sales: 160},
{ date: '2024-06-19', sales: 168},
{ date: '2024-06-20', sales: 158},
{ date: '2024-06-21', sales: 172},
{ date: '2024-06-22', sales: 142},
{ date: '2024-06-23', sales: 144},
{ date: '2024-06-24', sales: 149},
{ date: '2024-06-25', sales: 145},
{ date: '2024-06-26', sales: 127},
{ date: '2024-06-27', sales: 111},
{ date: '2024-06-28', sales: 132},
{ date: '2024-06-29', sales: 156},
{ date: '2024-06-30', sales: 188},
{ date: '2024-07-01', sales: 144},
{ date: '2024-07-02', sales: 199},
{ date: '2024-07-03', sales: 132},
{ date: '2024-07-04', sales: 139},
{ date: '2024-07-05', sales: 149},
{ date: '2024-07-06', sales: 153},
{ date: '2024-07-07', sales: 198},
{ date: '2024-07-08', sales: 160},
{ date: '2024-07-09', sales: 196},
{ date: '2024-07-10', sales: 170},
{ date: '2024-07-11', sales: 168},
{ date: '2024-07-12', sales: 120},
{ date: '2024-07-13', sales: 139},
{ date: '2024-07-14', sales: 164},
{ date: '2024-07-15', sales: 113},
{ date: '2024-07-16', sales: 169},
{ date: '2024-07-17', sales: 142},
{ date: '2024-07-18', sales: 163},
{ date: '2024-07-19', sales: 116},
{ date: '2024-07-20', sales: 176},
{ date: '2024-07-21', sales: 107},
{ date: '2024-07-22', sales: 197},
{ date: '2024-07-23', sales: 197},
{ date: '2024-07-24', sales: 101},
{ date: '2024-07-25', sales: 139},
{ date: '2024-07-26', sales: 182},
{ date: '2024-07-27', sales: 177},
{ date: '2024-07-28', sales: 191},
{ date: '2024-07-29', sales: 171},
{ date: '2024-07-30', sales: 151},
{ date: '2024-07-31', sales: 178},
{ date: '2024-08-01', sales: 167},
{ date: '2024-08-02', sales: 145},
{ date: '2024-08-03', sales: 191},
{ date: '2024-08-04', sales: 160},
{ date: '2024-08-05', sales: 114},
{ date: '2024-08-06', sales: 159},
{ date: '2024-08-07', sales: 157},
{ date: '2024-08-08', sales: 200},
{ date: '2024-08-09', sales: 194},
{ date: '2024-08-10', sales: 177},
{ date: '2024-08-11', sales: 108},
{ date: '2024-08-12', sales: 171},
{ date: '2024-08-13', sales: 127},
{ date: '2024-08-14', sales: 119},
{ date: '2024-08-15', sales: 183},
{ date: '2024-08-16', sales: 167},
{ date: '2024-08-17', sales: 150},
{ date: '2024-08-18', sales: 126},
{ date: '2024-08-19', sales: 160},
{ date: '2024-08-20', sales: 152},
{ date: '2024-08-21', sales: 158},
{ date: '2024-08-22', sales: 104},
{ date: '2024-08-23', sales: 150},
{ date: '2024-08-24', sales: 103},
{ date: '2024-08-25', sales: 174},
{ date: '2024-08-26', sales: 166},
{ date: '2024-08-27', sales: 173},
{ date: '2024-08-28', sales: 138},
{ date: '2024-08-29', sales: 152},
{ date: '2024-08-30', sales: 126},
{ date: '2024-08-31', sales: 172},
{ date: '2024-09-01', sales: 102},
{ date: '2024-09-02', sales: 103},
{ date: '2024-09-03', sales: 184},
{ date: '2024-09-04', sales: 195},
{ date: '2024-09-05', sales: 164},
{ date: '2024-09-06', sales: 181},
{ date: '2024-09-07', sales: 143},
{ date: '2024-09-08', sales: 160},
{ date: '2024-09-09', sales: 168},
{ date: '2024-09-10', sales: 152},
{ date: '2024-09-11', sales: 155},
{ date: '2024-09-12', sales: 200},
{ date: '2024-09-13', sales: 115},
{ date: '2024-09-14', sales: 185},
{ date: '2024-09-15', sales: 145},
{ date: '2024-09-16', sales: 115},
{ date: '2024-09-17', sales: 175},
{ date: '2024-09-18', sales: 127},
{ date: '2024-09-19', sales: 184},
{ date: '2024-09-20', sales: 108},
{ date: '2024-09-21', sales: 186},
{ date: '2024-09-22', sales: 119},
{ date: '2024-09-23', sales: 115},
{ date: '2024-09-24', sales: 168},
{ date: '2024-09-25', sales: 124},
{ date: '2024-09-26', sales: 147},
{ date: '2024-09-27', sales: 171},
{ date: '2024-09-28', sales: 146},
{ date: '2024-09-29', sales: 188},
{ date: '2024-09-30', sales: 120},
{ date: '2024-10-01', sales: 150},
{ date: '2024-10-02', sales: 196},
{ date: '2024-10-03', sales: 135},
{ date: '2024-10-04', sales: 192},
{ date: '2024-10-05', sales: 124},
{ date: '2024-10-06', sales: 176},
{ date: '2024-10-07', sales: 109},
{ date: '2024-10-08', sales: 175},
{ date: '2024-10-09', sales: 180},
{ date: '2024-10-10', sales: 156},
{ date: '2024-10-11', sales: 198},
{ date: '2024-10-12', sales: 151},
{ date: '2024-10-13', sales: 154},
{ date: '2024-10-14', sales: 106},
{ date: '2024-10-15', sales: 177},
{ date: '2024-10-16', sales: 100},
{ date: '2024-10-17', sales: 105},
{ date: '2024-10-18', sales: 119},
{ date: '2024-10-19', sales: 178},
{ date: '2024-10-20', sales: 138},
{ date: '2024-10-21', sales: 180},
{ date: '2024-10-22', sales: 122},
{ date: '2024-10-23', sales: 182},
{ date: '2024-10-24', sales: 153},
{ date: '2024-10-25', sales: 172},
{ date: '2024-10-26', sales: 188},
{ date: '2024-10-27', sales: 129},
{ date: '2024-10-28', sales: 111},
{ date: '2024-10-29', sales: 155},
{ date: '2024-10-30', sales: 199},
{ date: '2024-10-31', sales: 123},
{ date: '2024-11-01', sales: 123},
{ date: '2024-11-02', sales: 182},
{ date: '2024-11-03', sales: 181},
{ date: '2024-11-04', sales: 110},
{ date: '2024-11-05', sales: 179},
{ date: '2024-11-06', sales: 196},
{ date: '2024-11-07', sales: 172},
{ date: '2024-11-08', sales: 110},
{ date: '2024-11-09', sales: 114},
{ date: '2024-11-10', sales: 143},
{ date: '2024-11-11', sales: 194},
{ date: '2024-11-12', sales: 197},
{ date: '2024-11-13', sales: 105},
{ date: '2024-11-14', sales: 167},
{ date: '2024-11-15', sales: 105},
{ date: '2024-11-16', sales: 140},
{ date: '2024-11-17', sales: 196},
{ date: '2024-11-18', sales: 183},
{ date: '2024-11-19', sales: 165},
{ date: '2024-11-20', sales: 184},
{ date: '2024-11-21', sales: 107},
{ date: '2024-11-22', sales: 146},
{ date: '2024-11-23', sales: 157},
{ date: '2024-11-24', sales: 112},
{ date: '2024-11-25', sales: 149},
{ date: '2024-11-26', sales: 173},
{ date: '2024-11-27', sales: 180},
{ date: '2024-11-28', sales: 169},
{ date: '2024-11-29', sales: 112},
{ date: '2024-11-30', sales: 157},
{ date: '2024-12-01', sales: 121},
{ date: '2024-12-02', sales: 159},
{ date: '2024-12-03', sales: 164},
{ date: '2024-12-04', sales: 171},
{ date: '2024-12-05', sales: 199},
{ date: '2024-12-06', sales: 135},
{ date: '2024-12-07', sales: 137},
{ date: '2024-12-08', sales: 125},
{ date: '2024-12-09', sales: 137},
{ date: '2024-12-10', sales: 174},
{ date: '2024-12-11', sales: 138},
{ date: '2024-12-12', sales: 136},
{ date: '2024-12-13', sales: 130},
{ date: '2024-12-14', sales: 152},
{ date: '2024-12-15', sales: 185},
{ date: '2024-12-16', sales: 148},
{ date: '2024-12-17', sales: 148},
{ date: '2024-12-18', sales: 146},
{ date: '2024-12-19', sales: 117},
{ date: '2024-12-20', sales: 149},
{ date: '2024-12-21', sales: 200},
{ date: '2024-12-22', sales: 131},
{ date: '2024-12-23', sales: 177},
{ date: '2024-12-24', sales: 124},
{ date: '2024-12-25', sales: 134},
{ date: '2024-12-26', sales: 128},
{ date: '2024-12-27', sales: 172},
{ date: '2024-12-28', sales: 146},
{ date: '2024-12-29', sales: 167},


    ];

    // Chart instance variable
    let chart;
    
    /**
     * Main function to render the chart with current filters
     */
    function renderChart() {
      // Get current filter values
      const grouping = document.getElementById('grouping').value;
      const startDate = document.getElementById('startDate').value;
      const endDate = document.getElementById('endDate').value;
      
      // Filter data by date range
      const filteredData = salesData.filter(item => item.date >= startDate && item.date <= endDate);
      
      // Group data by selected period
      const groupedData = groupData(filteredData, grouping);
      const labels = groupedData.map(item => item.sortDate);
      const currentValues = groupedData.map(item => item.value);
      
      // Get data for past period (1 year ago)
      const pastStartDate = subtractOneYear(startDate);
      const pastEndDate = subtractOneYear(endDate);
      const filteredPastData = salesData.filter(item => item.date >= pastStartDate && item.date <= pastEndDate);
      const pastGroupedData = groupData(filteredPastData, grouping);
      
      // Create mapping of past period labels to values
      const pastDataMap = {};
      pastGroupedData.forEach(item => {
        pastDataMap[item.label] = item.value;
      });
      
      // Get past values aligned with current period labels
      const pastValues = groupedData.map(item => {
        const pastLabel = getPastLabel(item.label, grouping);
        return pastDataMap[pastLabel] || null;
      });
      
      // Get current toggle states
      const pastPeriodVisible = document.getElementById('togglePastPeriod').checked;
      const showGrid = document.getElementById('toggleGrid').checked;
      const showDataPoints = document.getElementById('toggleDataValues').checked;
      const showAverage = document.getElementById('toggleAverage').checked;
      const showAnomalies = document.getElementById('toggleAnomalies').checked;
      
      // Calculate moving average (7 days for daily, 3 periods for others)
      const period = (grouping === 'daily') ? 7 : 3;
      const movingAverage = currentValues.map((value, index) => {
        const startIdx = Math.max(0, index - period + 1);
        const subset = currentValues.slice(startIdx, index + 1);
        return subset.reduce((sum, v) => sum + v, 0) / subset.length;
      });
      
      // Identify anomalies (>20% deviation from moving average)
      const anomalies = currentValues.map((value, index) => {
        const avg = movingAverage[index];
        return (Math.abs(value - avg) > 0.2 * avg) ? value : null;
      });
      
      // Get chart context
      const ctx = document.getElementById('salesChart').getContext('2d');
      
      // Create gradient for past period fill
      const gradient = ctx.createLinearGradient(0, 0, 0, ctx.canvas.height);
      gradient.addColorStop(0, 'rgba(255,165,0,0.8)');
      gradient.addColorStop(0.8, 'rgba(255,255,255,0.1)');
      
      // Destroy previous chart instance if exists
      if (chart) chart.destroy();
      
      // Create new chart
      chart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Actual Sales',
              data: currentValues,
              borderColor: 'blue',
              backgroundColor: 'blue',
              borderWidth: 3,
              fill: false,
              tension: 0.4,
              pointRadius: showDataPoints ? 3 : 0
            },
            {
              label: 'Past Period (1 year ago)',
              data: pastValues,
              borderColor: 'orange',
              backgroundColor: gradient,
              fill: true,
              tension: 0.4,
              hidden: !pastPeriodVisible,
              pointRadius: showDataPoints ? 3 : 0
            },
            {
              label: 'Average Sales',
              data: movingAverage,
              borderColor: 'purple',
              backgroundColor: 'purple',
              borderDash: [5, 5],
              fill: false,
              tension: 0.4,
              hidden: !showAverage,
              pointRadius: showDataPoints ? 3 : 0
            },
            {
              label: 'Anomalies',
              data: anomalies,
              borderColor: 'red',
              backgroundColor: 'red',
              fill: false,
              tension: 0.4,
              hidden: !showAnomalies,
              pointRadius: 5,
              showLine: false
            }
          ]
        },
        options: {
          responsive: false,
          maintainAspectRatio: false,
          interaction: { mode: 'index', intersect: false },
          plugins: {
            legend: {
              display: true,
              labels: {
                boxWidth: 10,
                boxHeight: 10,
                // Only show legend items for visible datasets
                filter: function(legendItem, chartData) {
                  const ds = chartData.datasets[legendItem.datasetIndex];
                  return !ds.hidden;
                }
              }
            },
            tooltip: {
              mode: 'index',
              intersect: false,
              callbacks: {
                title: (tooltipItems) => {
                  const date = new Date(tooltipItems[0].parsed.x);
                  return formatXAxisLabel(date, grouping);
                }
              }
            },
            datalabels: {
              display: showDataPoints,
              align: 'top',
              formatter: function(value) {
                return Math.round(value);
              },
              color: function(context) {
                return context.dataset.borderColor;
              }
            }
          },
          scales: {
            x: {
              type: 'time',
              time: {
                unit: (grouping === 'daily')
                  ? 'day'
                  : (grouping === 'weekly' || grouping === 'monthly' || grouping === 'quarterly')
                    ? 'month'
                    : 'year',
                displayFormats: { month: 'MMM-yy' }
              },
              ticks: {
                callback: function(value) {
                  const date = new Date(value);
                  return formatXAxisLabel(date, grouping);
                }
              },
              grid: { display: showGrid },
              title: { display: true, text: 'Period' }
            },
            y: {
              min: 0,
              grid: { display: showGrid },
              title: { display: true, text: 'Sales' },
              ticks: {
                callback: function(value) {
                  return Math.round(value);
                }
              }
            }
          }
        }
      });
      
      // Update summary cards with full dataset
      renderSummaries(salesData);
    }
    
    // Add event listeners for all filter controls
    document.getElementById('startDate').addEventListener('change', renderChart);
    document.getElementById('endDate').addEventListener('change', renderChart);
    document.getElementById('grouping').addEventListener('change', renderChart);
    document.getElementById('togglePastPeriod').addEventListener('change', renderChart);
    document.getElementById('toggleGrid').addEventListener('change', renderChart);
    document.getElementById('toggleDataValues').addEventListener('change', renderChart);
    document.getElementById('toggleAnomalies').addEventListener('change', renderChart);
    document.getElementById('toggleAverage').addEventListener('change', renderChart);
    
    // Initialize the page
    initializeDateFilters();
    renderChart();
  </script>
</body>
</html>
